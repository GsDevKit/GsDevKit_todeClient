#! /bin/bash
#=========================================================================
# Copyright (c) 2014, 2015 GemTalk Systems, LLC <dhenrich@gemtalksystems.com>.
#=========================================================================

echo "================="
echo "   GsDevKit script: $(basename $0) $*"
echo "================="

usage() {
  cat <<HELP
USAGE: $(basename $0) [-h] [-v Pharo3.0 | Pharo4.0 ]

Download and install a Linux or Mac or Pharo3.0 VM, image and changes file.

OPTIONS
  -h
     display help
  -v 3.0 | 4.0
     Choose the version of Pharo to use for the client. Default is 3.0.

EXAMPLES
  $(basename $0) -h
  $(basename $0)

HELP
}

set -e # exit on error
if [ "${GS_TODE_CLIENT}x" = "x" ] ; then
  echo "the GS_TODE_CLIENT environment variable needs to be defined"; exit 1
fi

version="Pharo3.0"
while getopts ":hv:" OPT ; do
  case "$OPT" in
    h) usage; exit 0;;
    v) version="${OPTARG}";;
   *) usage; exit 1;;
  esac
done
shift $(($OPTIND - 1))
if [ $# -ne 0 ]; then
  usage; exit 1
fi
echo "Installing $version"


# Download client

case $version in
  Pharo*)
    if [ -e "$GS_TODE_CLIENT/pharo/pharo-vm" ]; then
      echo "Pharo already installed. To reinstall delete pharo directory and try again."
      exit 0
    fi
    pushd $GS_TODE_CLIENT/pharo >& /dev/null
    case $version in
      Pharo3.0)
        wget -O- get.pharo.org/vm30 | bash
        wget -O- get.pharo.org/30 | bash
        ;;
      Pharo4.0)
        wget -O- get.pharo.org/vm40 | bash
        wget -O- get.pharo.org/40 | bash
        ;;
      *) usage; exit 1;;
    esac
    popd >& /dev/null
    ;;
  *) usage; exit 1;;
esac

echo "...finished $(basename $0)"
